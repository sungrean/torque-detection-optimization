<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Torque Angle Test Dashboard</title>
    <style>
        body {
            margin: 0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            display: flex;
            height: 100vh;
            background-color: #f5f7fa;
            overflow: hidden;
        }

        .sidebar {
            display: flex;
            flex-direction: column;
            background: linear-gradient(to bottom, #2b65af, #1a4a8a);
            color: white;
            box-shadow: 2px 0 10px rgba(0, 0, 0, 0.1);
            z-index: 10;
        }

            .sidebar button {
                writing-mode: vertical-lr;
                transform: rotate(180deg);
                border: none;
                background: #4a90e2;
                color: white;
                padding: 20px 10px;
                font-weight: bold;
                font-size: 16px;
                border-bottom: 1px solid rgba(255, 255, 255, 0.2);
                cursor: pointer;
                height: 120px;
                transition: all 0.3s ease;
            }

                .sidebar button:hover {
                    background: #3a7bc8;
                }

                .sidebar button.active {
                    background: #1a56db;
                    box-shadow: inset 0 0 15px rgba(0, 0, 0, 0.2);
                }

        .main {
            display: flex;
            flex-grow: 1;
            padding: 20px;
            overflow: auto;
            background-color: #f0f2f5;
        }

        .panel {
            display: none;
            width: 100%;
            animation: fadeIn 0.5s;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
            }

            to {
                opacity: 1;
            }
        }

        .panel.active {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        /* Sub-tabs styles */
        .sub-tabs {
            display: flex;
            background: white;
            border-radius: 8px 8px 0 0;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            margin-bottom: 0;
        }

        .sub-tab {
            flex: 1;
            padding: 12px 20px;
            background: #f8f9fa;
            border: none;
            border-right: 1px solid #e0e0e0;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            color: #666;
            transition: all 0.3s ease;
        }

            .sub-tab:first-child {
                border-radius: 8px 0 0 0;
            }

            .sub-tab:last-child {
                border-radius: 0 8px 0 0;
                border-right: none;
            }

            .sub-tab:hover {
                background: #e9ecef;
                color: #2b65af;
            }

            .sub-tab.active {
                background: #2b65af;
                color: white;
            }

        .sub-content {
            display: none;
            background: white;
            border-radius: 0 0 12px 12px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
            padding: 20px;
        }

            .sub-content.active {
                display: block;
            }

        /* Main Page Styles */
        .main-page-container {
            display: flex;
            width: 100%;
            height: 100%;
            gap: 20px;
        }

        .equipment-layout {
            flex: 2;
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
            position: relative;
            min-height: 600px;
        }

            .equipment-layout h3 {
                margin: 0 0 20px 0;
                color: #2b65af;
                font-size: 18px;
                border-bottom: 2px solid #e0e0e0;
                padding-bottom: 10px;
            }

        .layout-container {
            position: relative;
            width: 100%;
            height: 500px;
            background: #f8f9fa;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
        }

        /* Equipment positioning */
        .equipment {
            position: absolute;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 12px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 2px solid transparent;
        }

            .equipment:hover {
                transform: scale(1.05);
                box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            }

            /* Equipment status colors */
            .equipment.idle {
                background: #6c757d;
                color: white;
            }

            .equipment.ok {
                background: #28a745;
                color: white;
            }

            .equipment.ng {
                background: #dc3545;
                color: white;
            }

            .equipment.warning {
                background: #ffc107;
                color: #212529;
            }

        .tester {
            width: 80px;
            height: 60px;
        }

        .tester1 {
            top: 50px;
            left: 50px;
        }

        .tester2 {
            top: 200px;
            left: 50px;
        }

        .tester3 {
            top: 350px;
            left: 50px;
        }

        .robot {
            width: 60px;
            height: 60px;
            border-radius: 50%;
        }

        .robot1 {
            top: 150px;
            left: 200px;
        }

        .robot2 {
            top: 250px;
            left: 200px;
        }

        .conveyor {
            width: 20px;
            height: 400px;
            top: 50px;
            left: 300px;
            border-radius: 10px;
        }

        .error-zone {
            width: 100px;
            height: 40px;
            top: 100px;
            left: 350px;
            font-size: 10px;
        }

        .new-box {
            width: 80px;
            height: 40px;
            top: 400px;
            left: 350px;
            font-size: 10px;
        }

        .ng-box {
            width: 120px;
            height: 80px;
            top: 280px;
            left: 450px;
            font-size: 10px;
            background: white;
            border: 2px solid #dc3545;
            color: #dc3545;
            display: flex;
            flex-direction: column;
            padding: 5px;
        }

        .ng-box-title {
            font-weight: bold;
            margin-bottom: 5px;
            text-align: center;
        }

        .ng-positions {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 2px;
            flex-grow: 1;
        }

        .ng-position {
            width: 100%;
            height: 100%;
            border: 1px solid #dc3545;
            border-radius: 3px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 8px;
            cursor: pointer;
            transition: all 0.2s ease;
        }

            .ng-position.empty {
                background: #f8f9fa;
                color: #6c757d;
            }

            .ng-position.filled {
                background: #dc3545;
                color: white;
            }

            .ng-position:hover {
                transform: scale(1.1);
            }

        .fg-area {
            width: 60px;
            height: 60px;
            top: 350px;
            left: 600px;
            font-size: 10px;
        }

        /* Status panel styles */
        .status-panel {
            flex: 1;
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
            height: fit-content;
        }

        .status-section {
            margin-bottom: 20px;
        }

            .status-section h4 {
                margin: 0 0 10px 0;
                color: #2b65af;
                font-size: 16px;
                border-bottom: 1px solid #e0e0e0;
                padding-bottom: 5px;
            }

        .status-item {
            display: flex;
            justify-content: space-between;
            padding: 5px 0;
            font-size: 14px;
        }

            .status-item.fail {
                color: #dc3545;
            }

            .status-item.ok {
                color: #28a745;
            }

        .testers-container {
            display: flex;
            justify-content: space-around;
            gap: 20px;
            margin-bottom: 20px;
        }

        .tester {
            text-align: center;
            width: 30%;
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
            transition: transform 0.3s ease;
        }

            .tester:hover {
                transform: translateY(-5px);
            }

        .status {
            font-weight: bold;
            color: white;
            padding: 10px 20px;
            border-radius: 30px;
            display: inline-block;
            margin-bottom: 10px;
            font-size: 16px;
        }

        .ok {
            background: linear-gradient(to right, #00c853, #009624);
        }

        .ng {
            background: linear-gradient(to right, #ff3d00, #dd2c00);
        }

        .reason {
            background-color: #ffcdd2;
            color: #b71c1c;
            padding: 10px;
            margin-top: 5px;
            border-radius: 8px;
            font-size: 14px;
        }

        svg {
            width: 100%;
            height: 200px;
            border-left: 2px solid #555;
            border-bottom: 2px solid #555;
            margin: 0 auto;
            display: block;
            background: #f9f9f9;
        }

        .timestamp {
            font-size: 12px;
            margin-top: 10px;
            color: #666;
        }

        .alert-indicators {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 8px;
            margin-top: 15px;
        }

        .alert-indicator {
            display: inline-flex;
            align-items: center;
            font-size: 12px;
        }

        .alert-dot {
            display: inline-block;
            width: 10px;
            height: 10px;
            border-radius: 50%;
            margin-right: 5px;
        }

        .alert-green {
            background-color: #00c853;
        }

        .alert-red {
            background-color: #ff3d00;
        }

        .test-label {
            font-size: 10px;
            text-anchor: middle;
            font-weight: bold;
        }

        .angle-axis {
            position: relative;
            width: 100%;
            margin: 10px auto 0;
            display: flex;
            justify-content: space-between;
            font-size: 10px;
            color: #555;
        }

        .angle-tick {
            position: absolute;
            width: 1px;
            height: 5px;
            background-color: #555;
            bottom: 15px;
        }

        .aoi-panel {
            display: flex;
            height: 100%;
            gap: 20px;
        }

        .aoi-image {
            width: 40%;
            background: linear-gradient(to bottom right, #e3f2fd, #bbdefb);
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 12px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }

            .aoi-image img {
                max-width: 90%;
                max-height: 90%;
                border-radius: 8px;
                box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            }

        .aoi-tests {
            width: 60%;
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
        }

        .aoi-test-group {
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
        }

        .aoi-test-title {
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 15px;
            color: #2b65af;
            padding-bottom: 10px;
            border-bottom: 2px solid #e0e0e0;
        }

        .aoi-test-items {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
        }

        .aoi-test-item {
            padding: 12px;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            display: flex;
            align-items: center;
            background: #f9f9f9;
            transition: all 0.3s ease;
        }

            .aoi-test-item.ng {
                background: #ffebee;
                border-color: #ffcdd2;
            }

            .aoi-test-item.ok {
                background: #ebffec;
                border-color: #ebffec;
            }

            .aoi-test-item input[type="checkbox"] {
                margin-right: 10px;
                width: 18px;
                height: 18px;
                cursor: default;
            }

        .cycle-time-panel {
            display: flex;
            flex-direction: column;
            width: 100%;
        }

        .cycle-time-chart {
            width: 100%;
            height: 300px;
            background: linear-gradient(to right, #e3f2fd, #bbdefb);
            border-radius: 12px;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }

            .cycle-time-chart img {
                max-width: 100%;
                max-height: 100%;
                object-fit: cover;
            }

        .cycle-time-data {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
            margin-bottom: 20px;
        }

        .cycle-time-card {
            background: white;
            border-radius: 12px;
            padding: 20px;
            text-align: center;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
        }

        .cycle-time-value {
            font-size: 28px;
            font-weight: bold;
            color: #2b65af;
            margin-bottom: 5px;
        }

        .cycle-time-label {
            font-size: 16px;
            color: #666;
        }

        .cycle-time-table {
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
            overflow: hidden;
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        th {
            background-color: #2b65af;
            color: white;
            padding: 12px 15px;
            text-align: left;
        }

        td {
            padding: 12px 15px;
            border-bottom: 1px solid #e0e0e0;
        }

        tr:nth-child(even) {
            background-color: #f9f9f9;
        }

        tr:hover {
            background-color: #f1f8ff;
        }

        .status-ok {
            color: #00c853;
            font-weight: bold;
        }

        .status-ng {
            color: #ff3d00;
            font-weight: bold;
        }

        .connection-status {
            position: fixed;
            bottom: 20px;
            right: 20px;
            padding: 10px 20px;
            border-radius: 30px;
            font-weight: bold;
            background-color: #4caf50;
            color: white;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            display: flex;
            align-items: center;
        }

            .connection-status.connecting {
                background-color: #ff9800;
            }

            .connection-status.disconnected {
                background-color: #f44336;
            }

        .status-dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            margin-right: 8px;
        }

        .connected .status-dot {
            background-color: #00e676;
            box-shadow: 0 0 8px #00e676;
        }

        .connecting .status-dot {
            background-color: #ffc107;
            box-shadow: 0 0 8px #ffc107;
        }

        .disconnected .status-dot {
            background-color: #ff5252;
            box-shadow: 0 0 8px #ff5252;
        }

        .dashboard-title {
            position: absolute;
            top: 20px;
            left: 20px;
            font-size: 24px;
            font-weight: bold;
            color: #2b65af;
            background: rgba(255, 255, 255, 0.8);
            padding: 5px 15px;
            border-radius: 30px;
        }

        /* New styles for vertical test items */
        .test-items-container {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin-top: 15px;
        }

        .test-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 12px;
            border-radius: 6px;
            font-size: 14px;
        }

            .test-item.pending {
                background-color: #e0e0e0;
                color: #666;
            }

            .test-item.testing {
                background-color: #fff3e0;
                color: #e65100;
            }

            .test-item.passed {
                background-color: #e8f5e9;
                color: #2e7d32;
            }

            .test-item.failed {
                background-color: #ffebee;
                color: #c62828;
            }

        .test-item-values {
            font-family: monospace;
            margin-left: 10px;
        }

        .test-history {
            margin-top: 20px;
            max-height: 200px;
            overflow-y: auto;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            padding: 10px;
            background-color: white;
        }

        .history-item {
            padding: 8px 0;
            border-bottom: 1px solid #eee;
            font-size: 13px;
        }

            .history-item:last-child {
                border-bottom: none;
            }

        /* New styles for historical data section */
        .history-panel {
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
        }

        .history-title {
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 15px;
            color: #2b65af;
            padding-bottom: 10px;
            border-bottom: 2px solid #e0e0e0;
        }

        .history-filters {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .filter-group {
            display: flex;
            flex-direction: column;
            min-width: 200px;
        }

        .filter-label {
            font-size: 14px;
            margin-bottom: 5px;
            color: #555;
        }

        .filter-control {
            padding: 8px 12px;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 14px;
        }

        .query-button {
            background-color: #2b65af;
            color: white;
            border: none;
            padding: 8px 20px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            align-self: flex-end;
            transition: background-color 0.3s;
        }

            .query-button:hover {
                background-color: #1a4a8a;
            }

        .history-results {
            margin-top: 20px;
        }

        .history-chart {
            width: 100%;
            background: white;
            border-radius: 12px;
            margin-bottom: 20px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

            .history-chart svg {
                width: 100%;
                height: 200px;
                border-left: 2px solid #555;
                border-bottom: 2px solid #555;
                margin: 0 auto;
                display: block;
                background: #f9f9f9;
            }

        .chart-title {
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 15px;
            color: #2b65af;
        }

        .history-table {
            width: 100%;
            border-collapse: collapse;
        }

            .history-table th {
                background-color: #2b65af;
                color: white;
                padding: 10px 15px;
                text-align: left;
            }

            .history-table td {
                padding: 10px 15px;
                border-bottom: 1px solid #e0e0e0;
            }

            .history-table tr:nth-child(even) {
                background-color: #f9f9f9;
            }

            .history-table tr:hover {
                background-color: #f1f8ff;
            }

        .view-button {
            background-color: #2b65af;
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
            transition: background-color 0.3s;
        }

            .view-button:hover {
                background-color: #1a4a8a;
            }

        /* Updated history chart container to match tester style */
        .history-chart-container {
            text-align: center;
            width: 100%;
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
            transition: transform 0.3s ease;
            margin-bottom: 20px;
        }

            .history-chart-container:hover {
                transform: translateY(-5px);
            }

        .history-chart-content {
            display: flex;
            flex-direction: column;
            align-items: center;
            width: 100%;
        }

        .history-chart-info {
            width: 100%;
            text-align: center;
            margin-top: 10px;
        }

        .history-test-items-container {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin-top: 15px;
            width: 100%;
        }

        /* NG Reason Panel Styles */
        .ng-reason-panel {
            width: 100%;
        }

        .ng-reason-title {
            font-size: 24px;
            font-weight: bold;
            margin-bottom: 20px;
            color: #2b65af;
            padding-bottom: 10px;
            border-bottom: 3px solid #2b65af;
        }

        .ng-item-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
            border-left: 4px solid #dc3545;
        }

            .ng-item-header h4 {
                margin: 0;
                color: #dc3545;
                font-size: 18px;
            }

        .ng-details-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
            margin-bottom: 25px;
        }

        .ng-detail-card {
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
            border: 1px solid #e0e0e0;
        }

        .ng-detail-title {
            font-size: 16px;
            font-weight: bold;
            color: #2b65af;
            margin-bottom: 15px;
            padding-bottom: 8px;
            border-bottom: 2px solid #e0e0e0;
        }

        .ng-detail-content {
            color: #333;
        }

        .test-param {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid #f0f0f0;
        }

            .test-param:last-child {
                border-bottom: none;
            }

        .param-label {
            font-weight: 500;
            color: #666;
        }

        .param-value {
            font-weight: bold;
            color: #2b65af;
        }

        .error-item {
            display: flex;
            align-items: flex-start;
            margin-bottom: 15px;
            padding: 12px;
            border-radius: 8px;
            border-left: 4px solid #dc3545;
        }

            .error-item.error-primary {
                background: #ffebee;
            }

            .error-item.error-secondary {
                background: #fff3e0;
                border-left-color: #ff9800;
            }

        .error-icon {
            font-size: 18px;
            margin-right: 12px;
            margin-top: 2px;
        }

        .error-info {
            flex: 1;
        }

        .error-title {
            font-weight: bold;
            color: #dc3545;
            margin-bottom: 4px;
        }

        .error-desc {
            font-size: 14px;
            color: #666;
            line-height: 1.4;
        }

        .suggestion-list {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .suggestion-item {
            display: flex;
            align-items: flex-start;
            padding: 8px 0;
            font-size: 14px;
            line-height: 1.4;
        }

        .suggestion-number {
            font-weight: bold;
            color: #2b65af;
            margin-right: 8px;
            min-width: 20px;
        }

        .ng-actions {
            display: flex;
            gap: 15px;
            justify-content: center;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 8px;
        }

        .action-btn {
            padding: 10px 20px;
            border: none;
            border-radius: 6px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
        }

            .action-btn.primary {
                background: #28a745;
                color: white;
            }

                .action-btn.primary:hover {
                    background: #218838;
                }

            .action-btn.secondary {
                background: #6c757d;
                color: white;
            }

                .action-btn.secondary:hover {
                    background: #5a6268;
                }
    </style>
</head>
<body>

    <div class="sidebar">
        <button id="main-page-btn" class="active">Main</button>
        <button id="function-test-btn">Function Test</button>
        <button id="aoi-btn">AOI</button>
        <button id="cycle-time-btn">Cycle Time</button>
    </div>

    <div class="main">
        <!-- Main Page Panel -->
        <div id="main-page-panel" class="panel active">
            <div class="main-page-container">
                <div class="equipment-layout">
                    <h3>设备布局图</h3>
                    <div class="layout-container">
                        <!-- Testers -->
                        <div class="equipment tester tester1 warning" title="Tester 1 - 待机" data-status="warning">
                            <div>Tester 1</div>
                            <div style="font-size: 10px;">待机</div>
                        </div>
                        <div class="equipment tester tester2 ok" title="Tester 2 - 正常" data-status="ok">
                            <div>Tester 2</div>
                            <div style="font-size: 10px;">正常</div>
                        </div>
                        <div class="equipment tester tester3 ng" title="Tester 3 - 故障" data-status="ng">
                            <div>Tester 3</div>
                            <div style="font-size: 10px;">故障</div>
                        </div>

                        <!-- Robots -->
                        <div class="equipment robot robot1 idle" title="Robot 1 - 空闲" data-status="idle">
                            Robot 1
                        </div>
                        <div class="equipment robot robot2 ok" title="Robot 2 - 运行中" data-status="ok">
                            Robot 2
                        </div>

                        <!-- Conveyor -->
                        <div class="equipment conveyor ok" title="传送带 - 运行中" data-status="ok"></div>

                        <!-- Error Zone -->
                        <div class="equipment error-zone ng" title="错误区域 - 有故障产品" data-status="ng">
                            ERROR
                        </div>

                        <!-- New Box Area -->
                        <div class="equipment new-box ok" title="新产品区 - 正常" data-status="ok">
                            NEW BOX
                        </div>

                        <!-- NG Box Area -->
                        <div class="equipment ng-box" title="不良品盒子">
                            <div class="ng-box-title">NG Box</div>
                            <div class="ng-positions">
                                <div class="ng-position filled" data-position="1" title="位置1 - 不良品">1</div>
                                <div class="ng-position empty" data-position="2" title="位置2 - 空">2</div>
                                <div class="ng-position filled" data-position="3" title="位置3 - 不良品">3</div>
                                <div class="ng-position empty" data-position="4" title="位置4 - 空">4</div>
                                <div class="ng-position filled" data-position="5" title="位置5 - 不良品">5</div>
                                <div class="ng-position empty" data-position="6" title="位置6 - 空">6</div>
                            </div>
                        </div>

                        <!-- FG Area -->
                        <div class="equipment fg-area ok" title="成品区 - 正常" data-status="ok">
                            FG
                        </div>
                    </div>
                </div>

                <div class="status-panel">
                    <div class="status-section">
                        <h4>STATUS</h4>
                        <div class="status-item fail">
                            <span>Tester 3 FAIL</span>
                        </div>
                        <div class="status-item ok">
                            <span>Reject Out FULL</span>
                        </div>
                        <div class="status-item ok">
                            <span>AOI Conveyor FULL</span>
                        </div>
                        <div class="status-item ok">
                            <span>Robot 1 ERROR</span>
                        </div>
                        <div class="status-item ok">
                            <span>FG No Box Detected</span>
                        </div>
                        <div class="status-item fail">
                            <span>AOI FAIL - Wrong Endcap</span>
                        </div>
                        <div class="status-item fail">
                            <span>AOI FAIL - Swarping Not Seated</span>
                        </div>
                        <div class="status-item fail">
                            <span>AOI FAIL - Top Stookball Not Detected</span>
                        </div>
                    </div>

                    <div class="status-section">
                        <h4>PLAN</h4>
                        <div class="status-item">
                            <span>目标产量</span>
                            <span>500 PCS</span>
                        </div>
                        <div class="status-item">
                            <span>实际产量</span>
                            <span>244 PCS</span>
                        </div>
                        <div class="status-item">
                            <span>良品率</span>
                            <span>46%</span>
                        </div>
                        <div class="status-item">
                            <span>不良品</span>
                            <span>10 PCS</span>
                        </div>
                        <div class="status-item">
                            <span>停机时间</span>
                            <span>22Hr 52Min 16 Sec</span>
                        </div>
                    </div>

                    <div class="status-section">
                        <h4>操作说明</h4>
                        <div style="font-size: 12px; color: #666; line-height: 1.4;">
                            <div>1. 点击各个设备查看详细状态</div>
                            <div>2. 当出现故障报警时</div>
                            <div>3. 橙色设备需要关注</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Function Test Panel -->
        <div id="function-test-panel" class="panel">
            <!-- Sub-tabs navigation -->
            <div class="sub-tabs">
                <button class="sub-tab active" id="chart-tab" onclick="showSubTab('chart')">图表</button>
                <button class="sub-tab" id="history-tab" onclick="showSubTab('history')">History</button>
                <button class="sub-tab" id="ngreason-tab" onclick="showSubTab('ngreason')">NG Reason</button>
            </div>

            <!-- Chart sub-content -->
            <div id="chart-content" class="sub-content active">
                <div class="testers-container">
                    <!-- Tester data will be populated by JavaScript -->
                </div>
            </div>

            <!-- History sub-content -->
            <div id="history-content" class="sub-content">
                <div class="history-panel">
                    <div class="history-title">历史数据查询</div>
                    <div class="history-filters">
                        <div class="filter-group">
                            <label class="filter-label">开始时间</label>
                            <input type="datetime-local" class="filter-control" id="start-time">
                        </div>
                        <div class="filter-group">
                            <label class="filter-label">结束时间</label>
                            <input type="datetime-local" class="filter-control" id="end-time">
                        </div>
                        <div class="filter-group">
                            <label class="filter-label">载位</label>
                            <select class="filter-control" id="tester-select">
                                <option value="all">全部载位</option>
                                <option value="1">载位 1</option>
                                <option value="2">载位 2</option>
                                <option value="3">载位 3</option>
                            </select>
                        </div>
                        <div class="filter-group">
                            <label class="filter-label">状态</label>
                            <select class="filter-control" id="status-select">
                                <option value="all">全部状态</option>
                                <option value="OK">通过</option>
                                <option value="NG">失败</option>
                            </select>
                        </div>
                        <button class="query-button" id="query-button">查询</button>
                    </div>
                    <div class="history-results">
                        <div class="history-chart">
                            <div class="history-chart-container">
                                <div class="history-chart-content">
                                    <p>历史数据图表将在此显示</p>
                                </div>
                            </div>
                        </div>
                        <table class="history-table">
                            <thead>
                                <tr>
                                    <th>时间戳</th>
                                    <th>载位</th>
                                    <th>状态</th>
                                    <th>测试项目</th>
                                    <th>扭矩值</th>
                                    <th>查看</th>
                                </tr>
                            </thead>
                            <tbody id="history-table-body">
                                <tr>
                                    <td colspan="6" style="text-align: center;">请设置查询条件并点击查询按钮</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- NG Reason sub-content -->
            <div id="ngreason-content" class="sub-content">
                <div class="ng-reason-panel">
                    <div class="ng-reason-title">不良品原因分析</div>
                    <div class="ng-reason-info">
                        <div class="ng-item-header">
                            <h4 id="ng-item-title">NG位置详情</h4>
                            <span id="ng-item-time" class="timestamp"></span>
                        </div>

                        <div class="ng-details-grid">
                            <div class="ng-detail-card">
                                <div class="ng-detail-title">测试参数</div>
                                <div class="ng-detail-content">
                                    <div class="test-param">
                                        <span class="param-label">扭矩值:</span>
                                        <span class="param-value" id="ng-torque">3.2 Nm</span>
                                    </div>
                                    <div class="test-param">
                                        <span class="param-label">测试角度:</span>
                                        <span class="param-value" id="ng-angle">145°</span>
                                    </div>
                                    <div class="test-param">
                                        <span class="param-label">测试时间:</span>
                                        <span class="param-value" id="ng-duration">2.5s</span>
                                    </div>
                                </div>
                            </div>

                            <div class="ng-detail-card">
                                <div class="ng-detail-title">故障分析</div>
                                <div class="ng-detail-content">
                                    <div class="error-item error-primary">
                                        <span class="error-icon">⚠️</span>
                                        <div class="error-info">
                                            <div class="error-title">BC阀扭矩异常</div>
                                            <div class="error-desc">实测值3.2Nm超出正常范围(1.2-3.0Nm)</div>
                                        </div>
                                    </div>
                                    <div class="error-item error-secondary">
                                        <span class="error-icon">⚠️</span>
                                        <div class="error-info">
                                            <div class="error-title">PRV阀响应延迟</div>
                                            <div class="error-desc">响应时间2.5s超出标准(≤2.0s)</div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="ng-detail-card">
                                <div class="ng-detail-title">建议措施</div>
                                <div class="ng-detail-content">
                                    <div class="suggestion-list">
                                        <div class="suggestion-item">
                                            <span class="suggestion-number">1.</span>
                                            <span>检查BC阀组装是否正确</span>
                                        </div>
                                        <div class="suggestion-item">
                                            <span class="suggestion-number">2.</span>
                                            <span>检查润滑油是否充足</span>
                                        </div>
                                        <div class="suggestion-item">
                                            <span class="suggestion-number">3.</span>
                                            <span>检查PRV阀密封件状态</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="ng-actions">
                            <button class="action-btn primary" onclick="markAsResolved()">标记已处理</button>
                            <button class="action-btn secondary" onclick="exportReport()">导出报告</button>
                            <button class="action-btn secondary" onclick="viewHistory()">查看历史</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- AOI Panel -->
        <div id="aoi-panel" class="panel">
            <div class="aoi-panel">
                <div class="aoi-image">
                    <img src="./闭门器.png" alt="产品检测图像">
                </div>
                <div class="aoi-tests">
                    <!-- AOI test groups will be populated by JavaScript -->
                </div>
            </div>
        </div>

        <!-- Cycle Time Panel -->
        <div id="cycle-time-panel" class="panel">
            <div class="cycle-time-chart">
                <img src="./测试结果.jpg" alt="循环时间趋势图">
            </div>
            <div class="cycle-time-data">
                <div class="cycle-time-card">
                    <div class="cycle-time-value">-- 秒</div>
                    <div class="cycle-time-label">平均循环时间</div>
                </div>
                <div class="cycle-time-card">
                    <div class="cycle-time-value">-- 秒</div>
                    <div class="cycle-time-label">最大循环时间</div>
                </div>
                <div class="cycle-time-card">
                    <div class="cycle-time-value">-- 秒</div>
                    <div class="cycle-time-label">最小循环时间</div>
                </div>
            </div>
            <div class="cycle-time-table">
                <table>
                    <thead>
                        <tr>
                            <th>测试序号</th>
                            <th>循环时间(秒)</th>
                            <th>状态</th>
                            <th>时间戳</th>
                        </tr>
                    </thead>
                    <tbody id="cycle-time-records">
                        <tr><td colspan="4" style="text-align: center;">加载数据中...</td></tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <div id="connection-status" class="connection-status">
        <span class="status-dot"></span>
        <span id="status-text">连接服务器...</span>
    </div>

    <script>
        // WebSocket连接状态
        const connectionStatus = document.getElementById('connection-status');
        const statusText = document.getElementById('status-text');

        // 面板切换功能
        document.getElementById('main-page-btn').addEventListener('click', function () {
            showPanel('main-page-panel', 'main-page-btn');
        });

        document.getElementById('function-test-btn').addEventListener('click', function () {
            showPanel('function-test-panel', 'function-test-btn');
        });

        document.getElementById('aoi-btn').addEventListener('click', function () {
            showPanel('aoi-panel', 'aoi-btn');
        });

        document.getElementById('cycle-time-btn').addEventListener('click', function () {
            showPanel('cycle-time-panel', 'cycle-time-btn');
        });

        function showPanel(panelId, buttonId) {
            // 隐藏所有面板
            document.querySelectorAll('.panel').forEach(panel => {
                panel.classList.remove('active');
            });

            // 显示选中的面板
            document.getElementById(panelId).classList.add('active');

            // 更新按钮状态
            document.querySelectorAll('.sidebar button').forEach(button => {
                button.classList.remove('active');
            });

            document.getElementById(buttonId).classList.add('active');

            // 如果是Function Test面板，默认显示图表子选项卡
            if (panelId === 'function-test-panel') {
                showSubTab('chart');
            }
        }

        // 子选项卡切换功能
        function showSubTab(tabName) {
            // 隐藏所有子内容
            document.querySelectorAll('.sub-content').forEach(content => {
                content.classList.remove('active');
            });

            // 显示选中的子内容
            document.getElementById(tabName + '-content').classList.add('active');

            // 更新子选项卡按钮状态
            document.querySelectorAll('.sub-tab').forEach(tab => {
                tab.classList.remove('active');
            });

            document.getElementById(tabName + '-tab').classList.add('active');
        }

        // 设备点击事件处理
        document.querySelectorAll('.equipment').forEach(equipment => {
            equipment.addEventListener('click', function () {
                const title = this.getAttribute('title');
                alert(`设备信息: ${title}\n点击查看更多详细信息...`);
            });
        });

        // NG盒子位置点击事件处理
        document.querySelectorAll('.ng-position.filled').forEach(position => {
            position.addEventListener('click', function (e) {
                e.stopPropagation(); // 阻止事件冒泡
                const positionNum = this.getAttribute('data-position');

                // 跳转到Function Test页面的NG Reason子选项卡
                showPanel('function-test-panel', 'function-test-btn');
                showSubTab('ngreason');

                // 更新NG Reason页面的内容
                updateNGReasonContent(positionNum);
            });
        });

        // 更新NG Reason内容
        function updateNGReasonContent(positionNum) {
            // 模拟不同位置的不良品数据
            const ngData = {
                '1': {
                    title: 'NG位置1 - BC阀扭矩异常',
                    time: '2025-06-27 01:15:23',
                    torque: '3.2 Nm',
                    angle: '145°',
                    duration: '2.5s',
                    errors: [
                        { type: 'primary', title: 'BC阀扭矩异常', desc: '实测值3.2Nm超出正常范围(1.2-3.0Nm)' },
                        { type: 'secondary', title: 'PRV阀响应延迟', desc: '响应时间2.5s超出标准(≤2.0s)' }
                    ]
                },
                '3': {
                    title: 'NG位置3 - 油位检测失败',
                    time: '2025-06-27 01:12:15',
                    torque: '0.3 Nm',
                    angle: '85°',
                    duration: '1.8s',
                    errors: [
                        { type: 'primary', title: '油位检测异常', desc: '实测值0.3Nm低于最小值(0.8Nm)' },
                        { type: 'secondary', title: 'DC阀密封不良', desc: '检测到轻微泄漏' }
                    ]
                },
                '5': {
                    title: 'NG位置5 - Latch机构故障',
                    time: '2025-06-27 01:08:47',
                    torque: '4.2 Nm',
                    angle: '165°',
                    duration: '3.1s',
                    errors: [
                        { type: 'primary', title: 'Latch扭矩过高', desc: '实测值4.2Nm超出正常范围(1.0-3.5Nm)' },
                        { type: 'secondary', title: '机构卡滞', desc: '动作不流畅，存在阻力' }
                    ]
                }
            };

            const data = ngData[positionNum] || ngData['1'];

            // 更新页面内容
            document.getElementById('ng-item-title').textContent = data.title;
            document.getElementById('ng-item-time').textContent = data.time;
            document.getElementById('ng-torque').textContent = data.torque;
            document.getElementById('ng-angle').textContent = data.angle;
            document.getElementById('ng-duration').textContent = data.duration;

            // 更新错误信息
            const errorContainer = document.querySelector('.ng-detail-card:nth-child(2) .ng-detail-content');
            let errorHtml = '';
            data.errors.forEach(error => {
                errorHtml += `
              <div class="error-item error-${error.type}">
                <span class="error-icon">⚠️</span>
                <div class="error-info">
                  <div class="error-title">${error.title}</div>
                  <div class="error-desc">${error.desc}</div>
                </div>
              </div>
            `;
            });
            errorContainer.innerHTML = errorHtml;
        }

        // NG Reason页面的操作按钮功能
        function markAsResolved() {
            alert('标记为已处理 - 此功能将更新数据库状态');
        }

        function exportReport() {
            alert('导出报告 - 此功能将生成PDF报告');
        }

        function viewHistory() {
            showSubTab('history');
            alert('切换到历史记录页面');
        }

        // 初始化子选项卡
        function initializeSubTabs() {
            // 重新绑定NG盒子位置的点击事件
            document.querySelectorAll('.ng-position.filled').forEach(position => {
                position.addEventListener('click', function (e) {
                    e.stopPropagation();
                    const positionNum = this.getAttribute('data-position');
                    showPanel('function-test-panel', 'function-test-btn');
                    showSubTab('ngreason');
                    updateNGReasonContent(positionNum);
                });
            });
        }

        // 连接WebSocket服务器
        let ws;
        function connectWebSocket() {
            updateConnectionStatus('connecting', '连接服务器...');

            ws = new WebSocket('ws://localhost:3724');

            ws.onopen = function () {
                updateConnectionStatus('connected', '已连接 - 实时数据更新中');

                // 设置默认时间范围 (最近24小时)
                const now = new Date();
                const yesterday = new Date(now.getTime() - 24 * 60 * 60 * 1000);

                document.getElementById('start-time').value = formatDateTimeLocal(yesterday);
                document.getElementById('end-time').value = formatDateTimeLocal(now);
            };

            ws.onmessage = function (event) {
                const data = JSON.parse(event.data);

                // 根据数据类型更新不同面板
                if (data.function === 'FunctionTest') {
                    if (data.query === 'history') {
                        updateHistoryResults(data);
                    } else {
                        updateFunctionTestPanel(data);
                    }
                } else if (data.function === 'AOI') {
                    updateAOIPanel(data);
                } else if (data.function === 'TimeCycle') {
                    updateCycleTimePanel(data);
                }
            };

            ws.onerror = function (error) {
                console.error('WebSocket error:', error);
                updateConnectionStatus('disconnected', '连接错误 - 尝试重新连接...');
                setTimeout(connectWebSocket, 3000);
            };

            ws.onclose = function () {
                updateConnectionStatus('disconnected', '连接断开 - 尝试重新连接...');
                setTimeout(connectWebSocket, 3000);
            };
        }

        // 格式化日期时间为本地字符串 (用于datetime-local输入)
        function formatDateTimeLocal(date) {
            const year = date.getFullYear();
            const month = String(date.getMonth() + 1).padStart(2, '0');
            const day = String(date.getDate()).padStart(2, '0');
            const hours = String(date.getHours()).padStart(2, '0');
            const minutes = String(date.getMinutes()).padStart(2, '0');

            return `${year}-${month}-${day}T${hours}:${minutes}`;
        }

        // 更新连接状态显示
        function updateConnectionStatus(status, text) {
            connectionStatus.className = `connection-status ${status}`;
            statusText.textContent = text;
        }

        // 更新功能测试面板
        function updateFunctionTestPanel(data) {
            const testersContainer = document.querySelector('.testers-container');
            testersContainer.innerHTML = '';

            data.testers.forEach(tester => {
                const testerElement = document.createElement('div');
                testerElement.className = 'tester';

                // 生成测试阶段路径数据
                let pathsHTML = '';
                let circlesHTML = '';
                let labelsHTML = '';

                for (let i = 0; i < 6; i++) {
                    // 路径数据（简化版）
                    const pathD = [
                        'M0,180 C15,160 30,140 40,120',
                        'M40,120 C50,90 55,60 60,70',
                        'M60,70 C65,50 70,30 80,35',
                        'M80,35 C90,45 110,60 120,80',
                        'M120,80 C130,100 140,120 150,130',
                        'M150,130 C160,150 170,170 180,180'
                    ][i];

                    pathsHTML += `<path d="${pathD}" stroke="#555" fill="none" stroke-width="2"/>`;

                    // 标记点
                    const points = [
                        { x: 0, y: 180 },
                        { x: 40, y: 120 },
                        { x: 60, y: 70 },
                        { x: 80, y: 35 },
                        { x: 120, y: 80 },
                        { x: 150, y: 130 },
                        { x: 180, y: 180 }
                    ];

                    if (i < 6) {
                        circlesHTML += `<circle cx="${points[i].x}" cy="${points[i].y}" r="3" fill="#555"/>`;
                    }

                    // 测试阶段标签
                    const labels = [
                        { x: 20, y: 130 },
                        { x: 50, y: 60 },
                        { x: 70, y: 30 },
                        { x: 100, y: 60 },
                        { x: 135, y: 110 },
                        { x: 165, y: 160 }
                    ];

                    labelsHTML += `<text x="${labels[i].x}" y="${labels[i].y}" class="test-label">${i + 1}</text>`;
                }

                // 添加最后一个标记点
                circlesHTML += `<circle cx="180" cy="180" r="3" fill="#555"/>`;

                // 创建测试项列表
                const testItems = [
                    { name: "流畅度", status: "pending", min: "0.5Nm", max: "2.5Nm", value: "--" },
                    { name: "BC阀", status: "pending", min: "1.2Nm", max: "3.0Nm", value: "--" },
                    { name: "油位", status: "pending", min: "0.8Nm", max: "2.8Nm", value: "--" },
                    { name: "PRV阀", status: "pending", min: "1.5Nm", max: "4.0Nm", value: "--" },
                    { name: "DC阀", status: "pending", min: "0.7Nm", max: "2.2Nm", value: "--" },
                    { name: "Latch", status: "pending", min: "1.0Nm", max: "3.5Nm", value: "--" }
                ];

                // 更新测试项状态
                tester.testStages.forEach((stage, index) => {
                    if (stage !== null) {
                        testItems[index].status = stage ? "passed" : "failed";
                        testItems[index].value = stage ? "OK" : "NG";
                    } else {
                        testItems[index].status = "testing";
                        testItems[index].value = "...";
                    }
                });

                // 生成测试项HTML
                let testItemsHTML = '';
                testItems.forEach(item => {
                    testItemsHTML += `
                <div class="test-item ${item.status}">
                  <span>${item.name}</span>
                  <span class="test-item-values">(${item.min}/${item.max}) ${item.value}</span>
                </div>
              `;
                });

                testerElement.innerHTML = `
              <div>Tester ${tester.id}</div>
              <div class="status ${tester.status === 'OK' ? 'ok' : 'ng'}">${tester.status}</div>
              ${tester.reason ? `<div class="reason">${tester.reason}</div>` : ''}
              <svg>
                ${pathsHTML}
                ${circlesHTML}
                <text x="0" y="190" font-size="10">-180°</text>
                <text x="40" y="190" font-size="10">0°</text>
                <text x="60" y="190" font-size="10">30°</text>
                <text x="80" y="190" font-size="10">60°</text>
                <text x="120" y="190" font-size="10">120°</text>
                <text x="150" y="190" font-size="10">150°</text>
                <text x="180" y="190" font-size="10">180°</text>
                ${labelsHTML}
                <text x="5" y="50" font-size="10">高</text>
                <text x="5" y="120" font-size="10">中</text>
                <text x="5" y="190" font-size="10">低</text>
              </svg>
              <div class="angle-axis">
                <div class="angle-tick" style="left: 0px;"></div>
                <div class="angle-tick" style="left: 80px;"></div>
                <div class="angle-tick" style="left: 160px;"></div>
                <div class="angle-tick" style="left: 240px;"></div>
                <div class="angle-tick" style="left: 320px;"></div>
                <div>-180°</div>
                <div>-90°</div>
                <div>0°</div>
                <div>90°</div>
                <div>180°</div>
              </div>
              <div class="timestamp">${tester.timestamp}</div>

              <div class="test-items-container">
                ${testItemsHTML}
              </div>
            `;

                testersContainer.appendChild(testerElement);
            });
        }

        // 更新历史查询结果
        function updateHistoryResults(data) {
            const tableBody = document.getElementById('history-table-body');
            tableBody.innerHTML = '';

            if (data.results && data.results.length > 0) {
                data.results.forEach(result => {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                <td>${new Date(result.timestamp).toLocaleString()}</td>
                <td>载位 ${result.testerId}</td>
                <td class="${result.status === 'OK' ? 'status-ok' : 'status-ng'}">${result.status}</td>
                <td>${result.testName || '--'}</td>
                <td>${result.torqueValue || '--'}</td>
                <td><button class="view-button" data-id="${result.testerId}" data-timestamp="${result.timestamp}">查看</button></td>
              `;
                    tableBody.appendChild(row);
                });

                // Add event listeners to all view buttons
                document.querySelectorAll('.view-button').forEach(button => {
                    button.addEventListener('click', function () {
                        const testerId = this.getAttribute('data-id');
                        const timestamp = this.getAttribute('data-timestamp');
                        displayResultInChart(testerId, timestamp, data.results);
                    });
                });
            } else {
                tableBody.innerHTML = `
              <tr>
                <td colspan="6" style="text-align: center;">没有找到匹配的历史数据</td>
              </tr>
            `;
            }
        }

        function displayResultInChart(testerId, timestamp, results) {
            // Find the specific result
            const result = results.find(r =>
                r.testerId == testerId && r.timestamp === timestamp
            );

            if (!result) return;

            // Get the chart container
            const chartContainer = document.querySelector('.history-chart .history-chart-container');

            // 生成测试阶段路径数据
            let pathsHTML = '';
            let circlesHTML = '';
            let labelsHTML = '';

            for (let i = 0; i < 6; i++) {
                // 路径数据（简化版）
                const pathD = [
                    'M0,180 C15,160 30,140 40,120',
                    'M40,120 C50,90 55,60 60,70',
                    'M60,70 C65,50 70,30 80,35',
                    'M80,35 C90,45 110,60 120,80',
                    'M120,80 C130,100 140,120 150,130',
                    'M150,130 C160,150 170,170 180,180'
                ][i];

                pathsHTML += `<path d="${pathD}" stroke="#555" fill="none" stroke-width="2"/>`;

                // 标记点
                const points = [
                    { x: 0, y: 180 },
                    { x: 40, y: 120 },
                    { x: 60, y: 70 },
                    { x: 80, y: 35 },
                    { x: 120, y: 80 },
                    { x: 150, y: 130 },
                    { x: 180, y: 180 }
                ];

                if (i < 6) {
                    circlesHTML += `<circle cx="${points[i].x}" cy="${points[i].y}" r="3" fill="#555"/>`;
                }

                // 测试阶段标签
                const labels = [
                    { x: 20, y: 130 },
                    { x: 50, y: 60 },
                    { x: 70, y: 30 },
                    { x: 100, y: 60 },
                    { x: 135, y: 110 },
                    { x: 165, y: 160 }
                ];

                labelsHTML += `<text x="${labels[i].x}" y="${labels[i].y}" class="test-label">${i + 1}</text>`;
            }

            // 添加最后一个标记点
            circlesHTML += `<circle cx="180" cy="180" r="3" fill="#555"/>`;

            // 创建测试项列表
            const testItems = [
                { name: "流畅度", status: "pending", min: "0.5Nm", max: "2.5Nm", value: "--" },
                { name: "BC阀", status: "pending", min: "1.2Nm", max: "3.0Nm", value: "--" },
                { name: "油位", status: "pending", min: "0.8Nm", max: "2.8Nm", value: "--" },
                { name: "PRV阀", status: "pending", min: "1.5Nm", max: "4.0Nm", value: "--" },
                { name: "DC阀", status: "pending", min: "0.7Nm", max: "2.2Nm", value: "--" },
                { name: "Latch", status: "pending", min: "1.0Nm", max: "3.5Nm", value: "--" }
            ];

            // 生成测试项HTML
            let testItemsHTML = '';
            testItems.forEach(item => {
                testItemsHTML += `
              <div class="test-item ${item.status}">
                <span>${item.name}</span>
                <span class="test-item-values">(${item.min}/${item.max}) ${item.value}</span>
              </div>
            `;
            });

            // 创建图表HTML，样式与tester类一致
            chartContainer.innerHTML = `
            <div class="history-chart-content">
              <div>Tester ${testerId}</div>
              <div class="status ${result.status === 'OK' ? 'ok' : 'ng'}">${result.status}</div>
              ${result.reason ? `<div class="reason">${result.reason}</div>` : ''}
              <svg>
                ${pathsHTML}
                ${circlesHTML}
                <text x="0" y="190" font-size="10">-180°</text>
                <text x="40" y="190" font-size="10">0°</text>
                <text x="60" y="190" font-size="10">30°</text>
                <text x="80" y="190" font-size="10">60°</text>
                <text x="120" y="190" font-size="10">120°</text>
                <text x="150" y="190" font-size="10">150°</text>
                <text x="180" y="190" font-size="10">180°</text>
                ${labelsHTML}
                <text x="5" y="50" font-size="10">高</text>
                <text x="5" y="120" font-size="10">中</text>
                <text x="5" y="190" font-size="10">低</text>
              </svg>
              <div class="angle-axis">
                <div class="angle-tick" style="left: 0px;"></div>
                <div class="angle-tick" style="left: 80px;"></div>
                <div class="angle-tick" style="left: 160px;"></div>
                <div class="angle-tick" style="left: 240px;"></div>
                <div class="angle-tick" style="left: 320px;"></div>
                <div>-180°</div>
                <div>-90°</div>
                <div>0°</div>
                <div>90°</div>
                <div>180°</div>
              </div>
              <div class="timestamp">${new Date(timestamp).toLocaleString()}</div>

              <div class="history-chart-info">
                <div>测试项目: ${result.testName || '--'}</div>
                <div>扭矩值: ${result.torqueValue || '--'}</div>
              </div>

              <div class="history-test-items-container">
                ${testItemsHTML}
              </div>
            </div>
          `;
        }

        // 更新AOI面板
        function updateAOIPanel(data) {
            const aoiTestsContainer = document.querySelector('.aoi-tests');
            aoiTestsContainer.innerHTML = '';

            data.groups.forEach(group => {
                const groupElement = document.createElement('div');
                groupElement.className = 'aoi-test-group';

                let itemsHTML = '';
                group.items.forEach(item => {
                    itemsHTML += `
                <div class="aoi-test-item ${item.result ? 'ok' : 'ng'}">
                  <input type="checkbox" ${item.result ? 'checked' : ''}>
                  <label>${item.name}</label>
                </div>
              `;
                });

                groupElement.innerHTML = `
              <div class="aoi-test-title">${group.name}</div>
              <div class="aoi-test-items">
                ${itemsHTML}
              </div>
            `;

                aoiTestsContainer.appendChild(groupElement);
            });
        }

        // 更新循环时间面板
        function updateCycleTimePanel(data) {
            // 更新卡片数据
            document.querySelectorAll('.cycle-time-card .cycle-time-value')[0].textContent = `${data.average}秒`;
            document.querySelectorAll('.cycle-time-card .cycle-time-value')[1].textContent = `${data.max}秒`;
            document.querySelectorAll('.cycle-time-card .cycle-time-value')[2].textContent = `${data.min}秒`;

            // 更新表格数据
            const recordsBody = document.getElementById('cycle-time-records');
            recordsBody.innerHTML = '';

            data.records.forEach(record => {
                const row = document.createElement('tr');
                row.innerHTML = `
              <td>${record.id}</td>
              <td>${record.cycleTime}</td>
              <td class="status-${record.status.toLowerCase()}">${record.status}</td>
              <td>${record.timestamp}</td>
            `;
                recordsBody.appendChild(row);
            });
        }

        // 查询历史数据
        document.getElementById('query-button').addEventListener('click', function () {
            const startTime = document.getElementById('start-time').value;
            const endTime = document.getElementById('end-time').value;
            const testerId = document.getElementById('tester-select').value;
            const status = document.getElementById('status-select').value;

            if (!startTime || !endTime) {
                alert('请选择时间范围');
                return;
            }

            if (ws && ws.readyState === WebSocket.OPEN) {
                const query = {
                    function: 'FunctionTest',
                    query: 'history',
                    startTime: new Date(startTime).toISOString(),
                    endTime: new Date(endTime).toISOString(),
                    testerId: testerId !== 'all' ? testerId : null,
                    status: status !== 'all' ? status : null
                };

                ws.send(JSON.stringify(query));

                // 显示加载状态
                const tableBody = document.getElementById('history-table-body');
                tableBody.innerHTML = `
              <tr>
                <td colspan="6" style="text-align: center;">正在查询数据...</td>
              </tr>
            `;
            } else {
                alert('WebSocket连接未就绪，请稍后再试');
            }
        });

        // 更新设备状态函数
        function updateEquipmentStatus(equipmentId, status) {
            const equipment = document.querySelector(`.${equipmentId}`);
            if (equipment) {
                // 移除所有状态类
                equipment.classList.remove('idle', 'ok', 'ng', 'warning');
                // 添加新状态类
                equipment.classList.add(status);
                equipment.setAttribute('data-status', status);

                // 更新状态文本
                const statusDiv = equipment.querySelector('div:last-child');
                if (statusDiv && statusDiv.style.fontSize === '10px') {
                    switch (status) {
                        case 'idle':
                            statusDiv.textContent = '空闲';
                            break;
                        case 'ok':
                            statusDiv.textContent = '正常';
                            break;
                        case 'ng':
                            statusDiv.textContent = '故障';
                            break;
                        case 'warning':
                            statusDiv.textContent = '待机';
                            break;
                    }
                }
            }
        }

        // 模拟设备状态变化（演示用）
        function simulateStatusChanges() {
            const statuses = ['idle', 'ok', 'ng', 'warning'];
            const equipments = ['tester1', 'tester2', 'tester3', 'robot1', 'robot2'];

            setInterval(() => {
                const randomEquipment = equipments[Math.floor(Math.random() * equipments.length)];
                const randomStatus = statuses[Math.floor(Math.random() * statuses.length)];
                updateEquipmentStatus(randomEquipment, randomStatus);
            }, 10000); // 每10秒随机更新一个设备状态
        }

        // 页面加载后初始化
        window.addEventListener('load', function () {
            // 启动状态模拟（可选）
            // simulateStatusChanges();

            // 初始化子选项卡事件监听器
            initializeSubTabs();

            // 初始填充一些数据
            updateFunctionTestPanel({
                function: "FunctionTest",
                testers: [
                    {
                        id: 1,
                        status: "OK",
                        reason: "",
                        testStages: [true, true, true, true, true, true],
                        timestamp: new Date().toLocaleString()
                    },
                    {
                        id: 2,
                        status: "NG",
                        reason: "BC阀和PRV阀扭矩异常",
                        testStages: [true, false, false, false, false, false],
                        timestamp: new Date().toLocaleString()
                    },
                    {
                        id: 3,
                        status: "OK",
                        reason: "",
                        testStages: [true, true, true, true, true, true],
                        timestamp: new Date().toLocaleString()
                    }
                ]
            });

            // 连接WebSocket服务器
            connectWebSocket();
        });
    </script>

</body>
</html>